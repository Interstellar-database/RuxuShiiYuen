## RuxuShiiYuen :一个基于中介的开放式储存市场 (第四版)
<b>by シーン ホゥオン シー ジー (2023)</b>

## 简介

为了使分布式技术得到更加广泛的应用,使得计算机资源更加自由的买卖,以更加低价流通,更加方便的获取,以实现资源的最大化利用,以及更低的成本,本文提出了一种基于中介的开放式储存市场,以实现储存资源的自由流通,以及储存资源的成本的降低.

## 内容

本文首先介绍了分布式储存的发展历史,以及分布式储存的现状,然后介绍了RuxuShiiYuen开放式储存市场的概念,以及其实现方式,最后介绍了RuxuShiiYuen应用场景,以及RuxuShiiYuen市场经济模型.

## 目录

[1. 引言](#1-引言)

[2. storj v3](#2-storj-v3)

[3. RuxuShiiYuen概念](#3-RuxuShiiYuen开放式储存市场的概念)

[4. RuxuShiiYuen实现方式](#4-RuxuShiiYuen实现方式)

[5. RuxuShiiYuen应用场景](#5-RuxuShiiYuen应用场景)

[6. RuxuShiiYuen市场经济模型](#6-RuxuShiiYuen市场经济模型)

[7. 总结](#7-总结)

[8. 作者的话](#8-作者的话)

[9. 参考文献](#9-参考文献)

## 1. 引言

随着互联网的发展,以及云计算的发展,分布式技术得到了越来越广泛的应用,分布式技术可以实现资源的自由流通,以及储存资源的成本的降低.

本文首先介绍了分布式储存的发展历史,以及分布式储存的现状,然后介绍了RuxuShiiYuen开放式储存市场的概念,以及其实现方式,最后介绍了RuxuShiiYuen应用场景,以及RuxuShiiYuen市场经济模型.

## 2. storj-v3

### Storj设计原则
这次白皮书V3里面，首先提到的就是设计原则。设计原则有以下几个关键词：安全与隐私；去中心化；市场和经济；AWS S3 兼；耐用率, 硬件故障, 和 流失；延迟；带宽；对象大小；拜占庭容错；局部协作。

解读出以下几点重要信息：

1. 可以看出“安全和隐私”是Storj设计的第一原则。其他原则如果与这个原则冲突，都按照这条原则来执行。

基于这个第一原则，数据必须在进入Storj网络之前完成加密，而且加密算法是可插拔的，也就是可以使用不同加密算法加密。

2. 要想办法降低维护成本和带宽消耗。

3. Storj白皮书V3首次提出了 AWS S3的兼容。这样开发者就能快速将之前基于ASW S3编写的程序移植到Storj上。对中国开发者来说，兼容了AWS S3，就兼容了阿里云OSS。

4. 存储节点一般归为三类：

    1. 拜占庭节点：有主观意愿作恶的节点。
    2. 利他节点：抛开不可避免的硬件故障，完全遵守规则并且无私地给他人奉献的好节点。
    3. 理性节点：在遵守规则的前提，追求自己利润最大化的节点。
   
5. 为了达到整体的规模最大，局部协议的最小化协调是Storj非常提倡的。

### 角色

Storj的系统中有以下这些角色：

1. 客户端：在网络中上传和下载数据的用户或应用程序
2. 节点的类型:
   1. 存储节点: 用于存储数据，获得收益
   2. Uplinks节点：用于实现库libuplink，并希望存储和检索数据的任何应用程序或服务。 预计此类节点不会像其他两类一样保持在线状态，并且相对轻量。
   3. Libuplink（一个库）
   4. Gateway（网关）
   5. Uplink CLI（控制台命令）
   6. <b>卫星节点</b>:用于缓存节点地址，存储对象元数据，维护存储节点信誉，聚合计费数据，支付存储节点，执行审计和修复，以及管理授权和用户帐户。

用户拥有帐户并信任特定的卫星节点。任何用户都可以运行他们自己的卫星节点，Storj希望许多用户选择使用其他卫星节点，避免操作复杂。有了卫星节点，Storj整体架构就非常灵活。

### 储存节点

存储节点的作用是存储和返回数据。选择存储节点以基于各种标中和评估：ping时间，延迟，吞吐量，带宽上限，足够的磁盘空间，地理位置，正常运行时间，准确响应审计的历史记录等等。这点和传统P2P项目选择节点的方式非常接近。

1. 可以存储具有特定TTL到期的片段，其中期望在到期之后删除数据。
2. 存储节点必须另外跟踪已签名的带宽分配，以便发送到卫星节点以后进行结算和支付。
3. TTL和带宽分配都存储在SQLite数据库中。
4. 存储节点可以选择使用哪些卫星节点。 如果它们使用多个卫星节点（默认行为），那么付款可能来自不同的付款时间表上的多个来源。
5. 未通过随机审核的存储节点将从池中删除，可能会损失托管中的资金以支付额外费用，并且将来只会收到付款。
6. 存储节点将支持三种方法：get，put和delete。 每种方法都将采用分片ID，卫星节点ID，来自相关卫星节点实例的签名以及带宽分配。
7. 存储节点将允许管理员在过去30天内配置允许的最大磁盘空间和每个Satellite的带宽使用量。

### 卫星节点

卫星节点：保存元数据的服务集合。网络用户将拥有特定卫星节点上的帐户，该实例将存储文件元数据，管理数据授权，跟踪存储节点的可靠性，在减少冗余时修复和维护数据，代表用户向存储节点付款。

注意，Storj中， 用户不是直接向存储节点付款的，而是用户先付款给卫星节点，然后卫星节点再付款给存储节点的。

1. 卫星节点将作为开源软件发布。任何个人或组织都可以运行自己的卫星节点以方便网络访问。
2. 从未向卫星节点提供未加密的数据，并且不保存加密密钥。
3. 卫星节点实例由以下组件组成：
`完整节点发现缓存,
由加密路径索引的每对象元数据数据库,
帐户管理和授权系统,
存储节点信誉，统计信息和审核系统,
数据修复服务,
存储节点支付服务`

### 优点

1. 以产品和市场为目标，Storj真正重视了服务质量QoS，真心希望将去中心化存储落实到使用场景。
2. 非常注重安全和隐私，这是第一设计准则。
3. AWS S3兼容性，支持了AWS S3的几个核心API。对开始者来说，这是一件好事。
4. 避免拜占庭分布式共识，这样就能大大提升效率。
5. 设计了冗余细节，认真测算了耐用性，这是一个成熟的存储系统中最重要Qos。
6. 设计元数据，并单独对元数据做了处理。元数据不用于普通数据，是变化很频繁的。
7. 审计和信誉，特别引入了信誉值，对整体经济系统有积极的良性影响。

### 缺点

1. 非常依赖于纠删技术，数据修复开销非常大。
2. 依然很少提及区块链技术，Storj对区块链技术的考虑非常少，作为一个做了7年多的项目，却还是中心化的结算方式，有那么点让人失望。
3. 卫星节点是个非常集中的设计。除了存储数据外，其他所有的事情都由它做完。
4. 每月支付，支付周期太长，对存储节点来说不够友好，特别是新存储节点，得到的反馈很慢。
5. 带宽分配，以字节为单位，力度太低。
6. 很少考虑热门文件和内容分发的情况。

## 3. RuxuShiiYuen开放式储存市场的概念

这是一个基于可靠中介的开放式储存市场，其独特之处在于用户和储存节点之间的交易过程中存在一个中介机构`可以是智能合约,也可以是中心化机构`，该中介机构提供可靠的保障。与其他类似的储存市场不同，这个市场的中介不仅仅是提供交易撮合的角色，还会同时保护用户的既得利益。

在这个市场中，用户和储存节点可以自由地进行交易。用户可以发布存储需求，并与合适的储存节点达成交易协议。而中介机构在交易过程中扮演着重要的角色，确保交易的可靠性和安全性。

中介机构的存在为用户和储存节点提供了额外的保障。它可以监督交易的执行过程，确保双方遵守协议，并解决任何可能出现的争议或纠纷。中介机构还会对储存节点进行审核和评估，确保它们符合市场的要求和标准，从而提供可靠的储存服务。

与像Storj这样的储存市场不同，这个市场更加注重中介的角色。中介机构在交易中扮演着保护用户利益的角色，确保用户在交易过程中获得公平和可靠的待遇。这种基于可靠中介的市场模型可以提高用户的信任度，促进更多的交易和参与。

同时，中介机构在这个开放式储存市场中还具备根据用户需求自动执行既定操作的能力。这意味着中介机构可以根据用户的要求，在交易过程中自动执行一些特定的操作，以提供更便捷和高效的服务。

例如，当用户发布存储需求时，中介机构可以自动匹配合适的储存节点，并执行数据备份和冗余操作(可以在本地执行也可以在中介执行)，以确保数据的安全性和可靠性。中介机构还可以根据用户的需求，自动进行数据加密、压缩或解压缩等操作，以满足用户的个性化需求。

但是使用中介机构进行交易可能会产生额外的交易费用。用户在选择中介机构时应该综合考虑交易费用和其他因素，以确保自己能够获得合理的交易成本和良好的交易体验。

总而言之，这个基于可靠中介的开放式储存市场通过提供中介保障，确保用户和储存节点之间的交易安全可靠。中介机构的存在为用户提供了额外的保护，使他们能够放心地参与市场交易，并获得既得利益的保障。并且，中介机构在这个开放式储存市场中不仅仅扮演着保障用户利益的角色，还具备根据用户需求自动执行既定操作的能力。通过自动化操作，中介机构可以提供更加便捷和高效的储存服务，满足用户的个性化需求，并提升整个市场的效率和稳定性。

## 4. RuxuShiiYuen实现方式

### 角色
#### 中介
中介最重要的是作为一个交易保障平台和自动化安全可以执行代码平台,处理合同. 用于保障整个市场的信用,可以为最可靠的智能合约,或者中心化机构.

#### 服务提供者 (节点)
服务提供者是储存节点, 负责储存数据, 并可以提供数据服务.

#### 请求者
请求者是用户, 负责储存需求, 并可以请求数据服务.

### 通信与加密

在请求者和中介之间,请求者和节点之间,保证请求者的身份特别重要;因为请求者通常不会有固定的地址,所以就不能使用通信地址来保证身份,如果使用密码,那么密码就可能被泄露,所以使用公钥来保证身份是必要的.（节点不可能拿到用户名和密码来验证请求者身份吧？）

#### 非对称加密

什么是非对称加密？
非对称加密，也称为公钥加密，是一种加密方式，相对于对称加密，它使用两个不同的密钥，一个公钥和一个私钥。公钥可以公开，任何人都可以使用它来加密消息，但只有私钥的持有者才能将其解密。

在非对称加密中，公钥和私钥是一对密钥，它们是由数学算法生成的。公钥可以被广泛分发，而私钥则必须保密。当A想要给B发送加密消息时，A使用B的公钥对消息进行加密，然后将密文发送给B。B收到密文后，使用自己的私钥进行解密，得到原始的消息。

###### 非对称加密具有以下特点：

1. 安全性高：非对称加密使用不同的密钥进行加密和解密，相对于对称加密，更加安全，因为攻击者无法从公钥中推断出私钥。
2. 公钥分发方便：公钥是公开的，任何人都可以使用它来加密消息，因此公钥的分发相对来说更加方便。

###### 非对称加密的工作原理是什么？
非对称加密的工作原理是基于数学算法的。它使用两个不同的密钥，一个公钥和一个私钥。公钥可以公开，任何人都可以使用它来加密消息，但只有私钥的持有者才能将其解密。


#### 数字签名

数字签名是一种用于验证消息完整性和身份认证的技术，它使用非对称加密算法中的私钥来生成签名，而不是进行加密。

数字签名的过程如下：
1. 发送方使用私钥对要发送的消息进行哈希运算，生成消息摘要。
2. 发送方使用私钥对消息摘要进行加
密，生成数字签名。
3. 发送方将消息和数字签名一起发送给接收方。

接收方在接收到消息后，可以使用发送方的公钥来验证数字签名的有效性，并确保消息的完整性和发送方的身份认证。验证数字签名的过程如下：
1. 接收方使用发送方的公钥对数字签名进行解密，得到解密后的消息摘要。
2. 接收方对接收到的消息进行哈希运算，生成新的消息摘要。
3. 接收方比较解密后的消息摘要和新生成的消息摘要，如果两者一致，则说明数字签名有效，消息没有被篡改，并且发送方的身份得到了认证。

使用私钥生成数字签名，用于验证消息的完整性和身份认证。

#### 数字签名在本项目的作用

中介和节点在收到一个请求时会首先验证请求者的身份, 然后验证请求者的身份是否合法, 合法则将请求者的请求作为有效请求进行处理, 否则拒绝请求.

节点和中介也会使用数字签名进行通信, 保证通信的安全性.

### 账户

因为在买卖过程中涉及到价值交换,价值交换一定会有个交换对象,这个对象便是账户,账户基本数据有五种,一是公钥,二是私钥,三是身份,四是备注,五是余额;但是一个账号在链接其他系统的时候也会在其他系统产生对应的数据,比如合同

同时在自动化处理中,账户也是必要的,这用于区分处理时的身份

#### 身份简述

身份是一个集合,其中包含了你拥有的所有身份,例子:
```
{
    '外部持有账户', // 这一类有 : 外部持有账户和中介账户
    'xxxxx(合同id)合同签订者',
    'xxxxxx(节点名)拥有者',
}
```
#### 账户使用成本(交易费)

用户使用中介的时候一定会产生一些资源消耗,会有内存硬盘的占用,如果中介是中心化机构,账户使用成本那么将由中心化机构自行扣除,如果使用的是智能合同的区块链应用,则以交易费为准
`用了不交钱?想屁吃,又不是做公益`


### 合同  
价值交换需要一个绝对可以执行的约定，而约定少不了各种逻辑判断，因此合同实际是一个可以进行状态转移的一个机器在启动的时候使用一些东西（或不用）来初始化状态在运行中进行状态的转移，在结算时根据状态来决定价值转移的方向和额度。因此可以得出，合同是一个固有价值，可以由外界的触发来进行（或不进行）相应的状态转移，最后根据合同状态来决定如何将自身进行转移的“机器”。  

为了实现这个机器可以基于下面的要求进行开发、  
1. 合同不可违的，值签订，合同将被严格执行 
2. 合同要有自己的储存，计算资源，用于改变合同状态。  
1. 合同要给外界触发进行状态转移，因此应有一些“合同API”
1. 合同有自己拥有的金额
1. 外界可以获取合同的状态，特别是合同鉴定的甲方和乙方，以便根据合同的状态来判断是否进行操作。
1. 合同可以被自由书写（但在这里只能用官方判定的模板套用书写）（用代码写合同）根据这些要求可以得出更深一层的概念：



##### 合同提交

合同在提交人提交后进行初始化可以在初始时提供必须数据.
注意:只能使用[合同模版]()(见下文)进行提交。合同提交时提交的合同价值会进行扣除，在结算后会遵循结算结果。


##### 合同签订

可以在签订合同时成为合同乙方，可以在签订时提供必须数据,然后执行一定的逻辑.

##### 合同执行

合同执行即合同主逻辑的执行合同执行需满足一些条件即：
1. 合同已经签订
1. 到达此前约定时间或签订后强制执行垎合同

##### 合同结算

合同执行后进行计算需满足一定条件：
1. 合同已执行
2. 到达结算时间或到达合同过期时间或主逻辑结束后前置结算

##### 合同公开性

有些时候合同需要具备一定公开性。一是签订对象的广泛性：二是合同对象的公开性：三是合同API调用的公开性，这已经在前面解决了。  

（I） 签订对象的支持：合同支持1对1、1对多、多对多、即甲——乙 或 甲（1）甲（2）——乙 或 甲（1）甲（2）——乙（1）乙(2)   <b>注意:目前只打算支持单对单</b>

（II）签订对象的广泛性、指定签订对象、即甲乙两方固定，面向一个群体，即甲乙方固定面向一个群体，即甲属于<甲方群体>甲属于甲方群体 乙属于<乙方群体>或者甲，乙<某个群体>  
<b>注意:目前只打算支持单对单</b>

（III）合同状态查询公开性： 
可以用表达式来表示，如`A∈{甲，乙}`
`A∈<节点运营者>∩<中国>`

##### 合同信息汇总
经过了上文的各种概念可以得出合同要什么信息在此汇总
1. 甲方列表
2. 乙方列表
3. 合同储存
4. 合同模板ID
5. 合同ID
6. 合同提交时间
7. 合同执行结果（结算结果）
8. API调用记录
9. 预定结算时间、执行时间
10. 签定证明（用私钥加密的我在XXX时签定XXX合同在XXX方块和公钥）  
11. 合同价值（合同金额）
12. 合同公开性
13. 过期时间（销毁时间）,通常为 ∞(无穷)

##### 合同代码

一个合同在一些代码，这些代码负责处理“合同APi" 调用，通过更改合同储存来改变合同的状态，在合同结束时计算出价值转移的方向和额度，因此可以分类合同代码。

##### 初始化代码

这种代码在提交时执行执行它可以接受初始化参数进行一些操作,初始化参数由提交者(甲方)提供.  

##### 签定代码

在合同签订时执行（即确认乙方时），它可以接受签定参数，签定参数由乙方提供，它还可以决定合同主逻辑是否在签定完成后就立刻执行主逻辑.

#### 合同主逻辑代码

在完成了初始化和签定后 以及达到合同执行的几种形式开始执行后运行的代码：如果有合同API合同就会由API回调代码结算或到后期结算，如果没有合同API将执行合同代码直到执行到EXIT()或执行完毕，合同API由外部API调用所有人都可以调用合同API但合同API也有调用后不作出任何行动的权力。主逻辑代码可以在运行结束后强制结算。

##### 结算代码

在满足条件后执行的代码，可以根据合同状态来分配合同自身价值流向甲方还是乙方，额度是多少。

##### 合同模板

合同模版顾名思义,不多解释,它可以任何账户创建并套用.

提交任何合同之前都确定合同写什么，即合同模板，它类似下面:

1. 拟定甲方列表格式
2. 拟定乙方列表形式
3. 合同代码
4. 拟定合同价值
5. 拟定合同公开性
6. 拟定结算时间执行时间（预定）
7. 公钥匙的加密时间，
8. 其他信息

提交合同必须使用合同模版,特定的模版作者(比如`中介账户`)有特定的权限对中介的各种资源进行操作,这个是很重要的一个特性,这样可以保证只有指定的合同模版代码才可以对中介内部资源进行操作,防止恶意操作.(总不可以让用户自己写的代码随便的在中介内部进行操作吧!)

##### 合同意义

合同在开放式储存市场中具有重要的意义。它是交易的约定，确保交易的可靠性和安全性，并规定了交易双方的权益和责任。以下是合同的一些重要意义：

1. 约定权益和责任：合同明确了交易双方的权益和责任，包括数据储存的期限、价格、数据安全性等。通过合同的签订，可以确保交易双方的权益得到保护，并减少纠纷的发生。

2. 保障数据安全和可靠性：合同规定了数据储存的要求和标准，包括数据备份、冗余、加密等措施。通过合同的执行，可以确保数据的安全和可靠性，防止数据丢失或被篡改。

3. 规范交易流程：合同规定了交易的流程和条件，包括合同的签订、执行和结算等。通过合同的约束，可以规范交易流程，提高交易的效率和可靠性。

4. 提供争议解决机制：合同规定了争议解决的机制和程序，包括仲裁、调解等方式。通过合同的约定，可以提供一种公正、公平的争议解决机制，保障交易双方的权益。

5. 促进市场发展：合同为市场参与者提供了一种可靠的交易方式，增加了市场的透明度和可信度。通过合同的约束，可以促进市场的发展，吸引更多的参与者和资源。

总之，合同在开放式储存市场中具有重要的意义，它是保障交易安全和可靠性的重要工具，也是促进市场发展的重要手段。通过合同的约定和执行，可以建立一个公正、公平、可信的储存市场，为用户提供更好的储存服务。

### 服务提供者（节点）
节点由外部持有账户控制，节点友谊个节点名和对应的节点地址，成为节点要进行注册，

1. 节点注册：提交一份中介账户写的节点注册合同，乙方为中介账户，注册可能需要提供一些必要的数据，注册成功后会给所有者添加类似:"节点所有者","XX 节点所有者","XX(名称)节点所有者的具体身份",并在账户备注中添加{<节点名>:<节点地址>}合同结算时会去除节点所有者身份".(节点名称示例:星织的巨形储存节点——`<UUID>（随机生成字符串，预防重名）`).  
2. 节点类型：储存，缓存

### 储存节点与缓存节点

储存节点与缓存节点是两种不同的节点类型，储存节点负责储存数据，缓存节点负责缓存数据。

用户可以从储存节点获取数据，也可以从缓存节点获取数据。但是添加数据时，只能添加到储存节点。所以储存节点和缓存节点的区别就在于一个可以添加数据，一个不能添加数据。

#### 节点注册合同通性

1. 它在结算的时候都会记录当前节点的信誉值在合同状态中
2. 都要交付保证金
3. 都要提供节点地址
4. 都要提供节点名称（非强制性）
#### 注册成为缓存节点

```
// 缓存节点注册合同模板
甲方 = 请求者自己;
乙方 = 中介账户;
执行时间 = 签订后执行（强制性）;
结算时间 = 自选（你想当多少个月的缓存节点）（大于等于一个月）;
结算 = 合同价值全都转移到甲方（归还保证金）;
API: 无;
状态对公性：对甲乙方开放（包括未签订时）;
合同价值：大于等于一定量的保证金（中介自定）（大于等于10 loseet 吧？）;
初始化条件：请求者自己不在“黑名单”中，提供节点地址，提供节点名称（非强制性）;
签订条件：无;
```

（看模板就知道了吧？不用教了吧？）

#### 注册成为储存节点


### 数据的增与查基本形式

这里的数据储存单单指的是基本的基于hash的储存，不包括比hash索引更高级别的索引，所以也不包括数据在全网的索引。

使用储存需要与节点签订相应的储存相关的合同，这种合同通常由请求者提交，节点进行签订。

#### 提取数据

###### 数据提取合同（单对单）模板：
```
甲方 = 请求者自己;
乙方 = 单一 储存节点 or 缓存节点;
执行时间 = 签订后执行（强制性）;
结算时间 = 主逻辑结束后结算（强制性）;
结算 = 合同价值全都转移到乙方;
API:无;
状态对公性：对甲乙方开发（包括未签订时）;
初始化条件：文件hash;
签订条件：乙方提供的数据的hash值正确;
```

###### 提取文件时序图

```mermaid
sequenceDiagram
	Title: Extract Files
	
    participant 请求者
    participant 中介
    participant 节点

    请求者 ->> 中介:提交合同,数据hash
    中介 -->> 请求者:提升成功
    请求者 ->> 节点:说明“我要文件”，并且提供合同id
    节点 ->> 中介:获取合同状态
    中介 -->> 节点:合同状态
    节点 ->> 节点:计算性价比
    节点 ->> 中介:签订合同
    节点 -->> 请求者:提示已完成合同签订
    节点 ->> 中介:记功，合同id（请求对应添加文件合同API）
    中介 -->> 节点:提示完成记功
    节点 -> 节点: end
    请求者 ->> 中介:下载合同状态
    中介 ->> 请求者:合同状态
    请求者 ->> 请求者:从合同状态中提取相应数据
    请求者 -> 请求者: end

```

#### 添加数据

###### 数据储存合同（单对单）（添加文件合同）模板：
```
甲方 = 请求者自己;
乙方 ∈ <所有储存节点> and 乙方 = 单一储存节点;
执行时间 = 签订后执行（强制性）;
结算时间 = 自定义（储存多少周呢？）;
结算 = 记功（详细见下文）;
API:1.记功API，需要合同ID　;
状态对公性：对甲乙方开发（包括未签订时）;
初始化条件：文件hash;
签订条件：自定义;
```
###### 添加文件时序图
```mermaid
sequenceDiagram
	Title: Add files
	
    participant 请求者
    participant 中介
    participant 节点

    请求者 ->> 中介:提交合同,数据hash
    中介 -->> 请求者:提升成功
    请求者 ->> 节点:上传数据,添加文件合同ID
    节点 ->> 中介:获取合同状态
    中介 -->> 节点:合同状态
    节点 ->> 中介:签订合同
    节点 -->> 请求者:提示他已完成储存

```

通过这些方式来进行数据提取和储存，可以有效保证市场公平。

### 账户代码

账户代码是上文提到的`根据用户需求自动执行既定操作的能力`形式之一,它能代替用户签名与节点交互,它能通过API触发与外界交互,它能通过合同签订触发自动完成合同.

账户代码运行在中介上,由用户自己编写(或者调用)部署,账户代码需要一个触发器,触发器会给与账户代码必要的数据,触发器可以有多种,如:"API触发","合同触发",目前也只打算支持这两种.

账户代码发送的请求代表着账户本身,会有`账户代码`的独特标识,这样子可以更好的把各种系统联系起来,更高效的解决用户需求,但是会增加交易费.

示例:提取文件

```mermaid
sequenceDiagram
	Title: Broadcast New Node Flowchart
	
    participant 请求者
    participant 请求者(账户代码)
    participant 中介(内部API)
    participant 节点(账户代码)
    participant 节点

    请求者 ->> 请求者(账户代码):要提提取的文件hash,节点地址,文件大小
    请求者(账户代码) ->> 中介(内部API):提交提取文件合同(自动计算价格)
    中介(内部API) -->> 请求者(账户代码):提交合同成功
    请求者(账户代码) -->> 请求者:提交合同成功
    中介(内部API) ->> 节点(账户代码):合同触发器(发送合同id)
    节点(账户代码) ->> 中介(内部API):获取合同数据
    中介(内部API) -->> 节点(账户代码):合同数据
    节点(账户代码) ->> 节点:需要提取的文件hash,价格
    节点 -->> 节点(账户代码):文件(或者拒绝)
    节点(账户代码) ->> 中介(内部API):签订合同(附带文件)(或者拒绝)
    节点(账户代码) ->> 节点(账户代码):退出代码
    中介(内部API) ->> 中介(内部API):合同检查文件是否符合要求(如果拒签则没有这一步)
    中介(内部API) ->> 请求者(账户代码):合同触发器:一个提取合同完成(附带:合同id)
    请求者(账户代码) ->> 中介(内部API):获得合同数据
    中介(内部API) ->> 请求者(账户代码):合同数据
    请求者(账户代码) ->> 请求者:hash,data,状态(完成或拒签)
    请求者 -->> 请求者(账户代码):OK

```

### 数据索引  

在不知道文件所处节点和不知文件hash的时候，文件几乎是无法找回的，本项目也因此会开发官方数据索引服务,以便用户使用数据索引.

###### hash to nobe index  
这是一份甲方乙方都是中介的合同,它没有结算时间,用户可以请求合同API来添加索引,任何人都可以添加,添加时需提供数据存储合同 ID ,甲方API请求者即可完成填加,它的数据结构为
`{<hash>:[合同ID A ,合同ID B , ...],....}`
一个 hash 值对一个集合,集合中是储存这个hash合同ID们.  

###### 文件系统(fs):  

文件系统会加入一个其他数据,还有各种文件管理常用的API它一样还是一个合同,但不一样的是在客户,但不一样的是在客户端上会加入解密,自动获取文件,自动请求API等操作,它还可以管理多节点,合同只是一个云端备份工具和一个支持他人访问的工具  

<!-- ###### 对象储存：  
对象储存是文件的升级版本（可以直接把对象储存套在虚拟驱动上）
数据索引会使得“路西原”更加易用，优雅。   
###### ipfs：待定
###### 星际数据库：待定   -->

### loseet代币相关  
为了更方便的进行数值交换，中介将使用代替EIA这类货币，因此支持“交易”每一个帐户都可以拥有一定数量的 loseet代币,loseet代币一般不会凭空产生只会在初期有所谓的送代币的用户福利，以半公益的状态进行，公益额度无了要“充钱“才可以使用使用，如”ETH“ ，”EOS“货币

### 分布式存储和数据冗余

这是一些结合数据索引和数据储存的内容

#### 分布式存储

分布式存储是一种将数据分散存储在多个节点上的存储方式。它具有以下优势：

pass

#### 数据冗余

数据冗余是指将数据复制多份存储在不同的节点上，以提高数据的可靠性和可用性。它具有以下优势：

pass


## 5-RuxuShiiYuen应用场景  

pass

## 7 总结  

在本书中，我们提出了一个基于中介的开放式储存市场的概念，旨在实现储存资源的自由流通和成本的降低。通过引入中介机构，我们可以保证交易的可靠性和安全性，并提供用户权益的保护。同时，我们还介绍了储存市场的经济模型，包括价格机制、奖励机制、惩罚机制和用户权益保护等关键因素。

在具体实现方面，我们提出了账户和合同的概念。账户是参与市场交易的主体，可以进行数据储存和提取等操作。合同是交易的约定，通过合同可以确保交易的可靠性和安全性。我们还介绍了合同的不同类型，包括数据储存合同和数据索引合同，并给出了相应的合同模板和时序图。

在应用场景方面，我们重点介绍了数据储存和数据索引两个方面。数据储存涉及到数据的提取和添加，通过合同的签订和执行，可以实现数据的安全储存和可靠提取。数据索引则是为了更方便地管理和查找数据，我们提出了hash to node index和文件系统两种索引方式。

最后，在作者的话中，我们总结了本书的主要内容和亮点，并展望了下一版的更新方向。我们希望通过本书的介绍，能够为开放式储存市场的建设和发展提供一些有益的思考和参考。

## 8 作者的话
这一版相对与第一版和第二版有更多的内容、更明确的定义、更成熟的方案更简单和更模块化的系统，提供更高的自由度，但在数据索引方面还缺少祥尽的解释，但这并不是本书的重点内容，因此给一个大致的方向而已。

本书对服务提供者（节点）下了更明确的定义而不是第一版一样更注重这个过程和设计要求，本书将系统实现的各种模块一一拆开并进行解释更明确的细分了“文件系统”和“存储介质”的概念，使得它更明朗，也更有利于开发，但本书对合同的应用没有讲解到位将在下一版更新。

本版对于存储节点中的缓存节点没能讲到，缓存节点可以减少主节点的宽带负担，同时也可以成为非服务器（24小时不间断贡献的节点）提供贡献的机会，未来版本将细讲。

本书对于很多实现上的细节都没有讲到，这些东西将在第三版出现，比如节点信用，交易保障梯度，还有类似storj需要卫星节点那种更低信用和更低费用的建议方式等等。
## 9 参考文献
以太坊白皮书：https://ethereum.org/zh/whitepaper/
storjv3白皮书： https://www.storj.io/storjv3.pdf
非对称加密：https://cloud.tencent.com/developer/techpedia/1797
比特币白皮书：https://bitcoin.org/bitcoin.pdf
storj白皮书v3最全面解读：https://www.jianshu.com/p/9c74511671be
## other content
<img src="D:/Downloads/QQ截图20231126151923.png" width="30%"></img>
Publish on https://github.com/Interstellar-database/RuxuShiiYuen
Contact :
📧 If you have any questions, suggestions, or collaboration inquiries, you can reach us through the following channels:
Email: Interstellar-database@outlook.com
GitHub : Interstellar-database Team
シーン ホゥオン シー ジー : xh-xhsz@foxmail.com
Thank you for your support to the Interstellar-database team! We look forward to creating and sharing a more fun and usable database project with you! 🌌✨🚀

